<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 智慧藥盒控制中心</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- 外部 CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">
        <h1>💊 藥盒控制中心</h1>

        <!-- 補藥模式提示 (預設隱藏) -->
        <div id="refill-status" class="refill-banner" style="display: none;">
            ⚠️ 補藥模式開啟中 (馬達已歸零)
        </div>

        <p id="loading">連線資料庫中...</p>

        <h2>即時監控 (Monitor)</h2>

        <div class="status-box">
            <div class="status-item">
                <div>目前溫度</div>
                <div id="temp-display" class="status-value">-- °C</div>
            </div>
            <div class="status-item">
                <div>連線狀態</div>
                <div id="connection-status" style="font-size: 1em; color: gray;">等待中...</div>
            </div>
        </div>

        <div style="text-align: center; color: #555;">內部圓盤藥杯狀態</div>
        <div class="cups-container">
            <div id="cup-0" class="cup-indicator">1</div>
            <div id="cup-1" class="cup-indicator">2</div>
            <div id="cup-2" class="cup-indicator">3</div>
            <div id="cup-3" class="cup-indicator">4</div>
            <div id="cup-4" class="cup-indicator">5</div>
        </div>

        <div style="margin-top: 15px; padding: 10px; background: #fff3e0; border-radius: 8px;">
            <div style="text-align: center; font-weight: bold; color: #e65100;">蓋子藥杯監控</div>
            <div style="display: flex; justify-content: space-around; margin-top: 10px;">
                <div style="text-align: center;">
                    <div style="font-size: 0.8em; color: #888;">目前數量</div>
                    <div id="lid-count" style="font-size: 1.5em; font-weight: bold;">--</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.8em; color: #888;">目標設定</div>
                    <div id="lid-target" style="font-size: 1.5em; font-weight: bold;">--</div>
                </div>
            </div>
            <div id="lid-match-msg" style="text-align: center; margin-top: 5px; font-weight: bold;">--</div>
        </div>

        <div id="hall-sensor" class="hall-status hall-inactive">
            單點霍爾：無訊號
        </div>

        <h2>手動控制 (Control)</h2>

        <p style="font-size: 0.8em; color: #888;">* 馬達運轉中請勿連續發送指令</p>

        <div style="margin-bottom: 5px;">圓盤馬達 (M1)</div>
        <div class="control-group">
            <button class="btn-motor" onclick="sendCommand('M1_CW')">↻ 正轉</button>
            <button class="btn-motor" onclick="sendCommand('M1_CCW')">↺ 反轉</button>
        </div>

        <div style="margin-bottom: 5px;">推桿馬達 (M2)</div>
        <div class="control-group">
            <button class="btn-motor" onclick="sendCommand('M2_UP')">⬆️ 上升</button>
            <button class="btn-motor" onclick="sendCommand('M2_DOWN')">⬇️ 下降</button>
        </div>

        <div style="margin-bottom: 5px;">環境控制</div>
        <div class="control-group">
            <button class="btn-on" onclick="sendCommand('FAN_ON')">風扇 開</button>
            <button class="btn-off" onclick="sendCommand('FAN_OFF')">風扇 關</button>
            <button class="btn-on" onclick="sendCommand('LED_ON')">燈條 開</button>
            <button class="btn-off" onclick="sendCommand('LED_OFF')">燈條 關</button>
        </div>

        <button class="btn-music" onclick="sendCommand('PLAY_MUSIC')">🎵 播放測試音效</button>

        <div style="margin-top: 20px; margin-bottom: 5px;">系統控制</div>
        <button class="btn-home" onclick="sendCommand('HOME')">🏠 回歸原點</button>
        <button class="btn-test" onclick="sendCommand('TEST_DISPENSE')">🧪 出藥測試</button>

        <div style="margin-top: 20px; margin-bottom: 5px; color: #00796b;">⏰ 設定</div>
        <div class="control-group" style="display: block;">
            <div style="margin-bottom: 10px;">
                <label>每日定時 (最多5組):</label>
                <div class="alarm-inputs">
                    <input type="time" id="alarm-0">
                    <input type="time" id="alarm-1">
                    <input type="time" id="alarm-2">
                    <input type="time" id="alarm-3">
                    <input type="time" id="alarm-4">
                </div>
            </div>

            <div style="margin-bottom: 10px;">
                <label>預計藥杯數 (目標):</label>
                <input type="number" id="target-cups-input" min="0" max="5" style="width: 50px; padding: 5px;">
            </div>

            <button class="btn-save" onclick="saveSettings()">💾 儲存設定</button>
        </div>

        <div style="margin-top: 20px; margin-bottom: 5px; color: #9c27b0;">🎬 Demo 展示模式</div>
        <div class="control-group">
            <button class="btn-test" onclick="sendCommand('DEMO_A')"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">🎬 Demo A (反轉)</button>
            <button class="btn-test" onclick="sendCommand('DEMO_B')"
                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">🎬 Demo B (正轉)</button>
        </div>
        <p style="font-size: 0.75em; color: #999; margin-top: 5px;">
            A: 推桿歸零 → 圓盤反轉一格 → 推桿推到最高<br>
            B: 推桿歸零 → 圓盤正轉一格 → 推桿推到最高
        </p>

    </div>

    <!-- 外部 JavaScript（順序重要：api.js 先載入）-->
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>

</body>

</html>