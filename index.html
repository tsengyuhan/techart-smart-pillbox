<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§è—¥ç›’é™æ§å™¨</title>
    <style>
        /* é€™è£¡åªæ˜¯ç‚ºäº†è®“æŒ‰éˆ•å¥½çœ‹ä¸€é»ï¼Œä¸ç”¨å¤ªåœ¨æ„ */
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f2f5;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
        }

        .status-box {
            font-size: 24px;
            margin: 20px 0;
            padding: 15px;
            background: #e8f0fe;
            border-radius: 10px;
            color: #1967d2;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-feed {
            background-color: #34a853;
            color: white;
        }

        /* ç¶ è‰²æŒ‰éˆ• */
        .btn-feed:active {
            background-color: #2e8b46;
        }

        .btn-stop {
            background-color: #ea4335;
            color: white;
        }

        /* ç´…è‰²æŒ‰éˆ• */
        .btn-stop:active {
            background-color: #c5221f;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ’Š è—¥ç›’æ§åˆ¶ä¸­å¿ƒ</h1>

        <div id="statusText" class="status-box">é€£ç·šä¸­...</div>

        <button id="btnFeed" class="btn btn-feed">è®“è—¥ç›’å‡ºè—¥ (ON)</button>
        <button id="btnStop" class="btn btn-stop">å¼·åˆ¶åœæ­¢ (OFF)</button>
    </div>

    <script type="module">
        // åŒ¯å…¥å¿…è¦çš„å‡½å¼
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, onValue }
            from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // --------------------------------------------------------
        // TODO: è«‹å°‡ä¸‹æ–¹çš„è¨­å®šæ›æˆä½ è‡ªå·±çš„ï¼
        // (åœ¨ Firebase Console -> å°ˆæ¡ˆè¨­å®š -> ä¸€èˆ¬ -> ä¸‹æ–¹çš„ SDK è¨­å®šèˆ‡é…ç½®)
        // --------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyBbp0kENACTRcVmV2PZW8Q2pHNtMdGhbZ0",
            authDomain: "smart-pillbox-23113.firebaseapp.com",
            databaseURL: "https://smart-pillbox-23113-default-rtdb.firebaseio.com",
            projectId: "smart-pillbox-23113",
            storageBucket: "smart-pillbox-23113.firebasestorage.app",
            messagingSenderId: "228363023113",
            appId: "1:228363023113:web:1522c20f1e29f2029499d8"
        };

        // 1. åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 2. å®šç¾©æˆ‘å€‘è¦æ§åˆ¶çš„è³‡æ–™è·¯å¾‘
        const commandRef = ref(db, 'command');

        // 3. ç›£è½ç‹€æ…‹ (ç•¶è³‡æ–™åº«è®Šå‹•æ™‚ï¼Œç¶²é ä¸Šçš„å­—ä¹Ÿè¦è·Ÿè‘—è®Š)
        onValue(commandRef, (snapshot) => {
            const data = snapshot.val();
            const statusText = document.getElementById("statusText");

            if (data === 1) {
                statusText.innerText = "ç‹€æ…‹ï¼šé¦¬é”è½‰å‹•ä¸­ ğŸ”„";
                statusText.style.color = "#ea4335"; // ç´…è‰²å­—
            } else {
                statusText.innerText = "ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­ âœ…";
                statusText.style.color = "#34a853"; // ç¶ è‰²å­—
            }
        });

        // 4. æŒ‰éˆ•åŠŸèƒ½ï¼šæŒ‰ä¸‹ã€Œå‡ºè—¥ã€
        document.getElementById("btnFeed").addEventListener("click", () => {
            set(commandRef, 1); // æŠŠ command æ”¹æˆ 1
        });

        // 5. æŒ‰éˆ•åŠŸèƒ½ï¼šæŒ‰ä¸‹ã€Œåœæ­¢ã€
        document.getElementById("btnStop").addEventListener("click", () => {
            set(commandRef, 0); // æŠŠ command æ”¹æˆ 0
        });

    </script>
</body>

</html>